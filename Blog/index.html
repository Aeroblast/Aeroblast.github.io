<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <META HTTP-EQUIV="pragma" CONTENT="no-cache">
    <META HTTP-EQUIV="Cache-Control" CONTENT="no-cache, must-revalidate">
    <META HTTP-EQUIV="expires" CONTENT="0">
    <title>AE在Github Page上的Blog</title>
    <style>
        body {
            background: #101010;
            color: antiquewhite;
        }

        #toc>div:hover {
            background: #303030;
        }

        #toc>div {
            border-bottom: #660000 solid 2px;
        }

        #toc {
            overflow: scroll;
        }

        #toc::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>

<body>
    <div style="-webkit-overflow-scrolling:touch; overflow:hidden;width:75%;position:fixed;left:20%;height:90%;">
        <iframe src="viewer.html?n=welcome" id="mainwin"
            style="width: 100%;height: 100%;border: 0 none;overflow-x:hidden;"></iframe>
    </div>
    <div id="toc" style="position:fixed;width: 18%;left: 2%;height: 100%;border-right: 1px solid brown">
        这里应该是目录……
    </div>
    <script src="util.js"></script>
    <script>

        var mainwin = document.getElementById("mainwin");
        var index=new Array();
        var n = GetQueryString("n");
        if (n != null)
            if (n.length > 1) {
                LoadBlog(n);
            }
        function LoadBlog(i) {
            let i_n=parseInt(i);
            let name=index[i_n][0];
            mainwin.src = "viewer.html?n=" + name +"&"+ RandomQuery();
            history.pushState({}, index[i_n][1], location.pathname+"?n="+name);
        }
        var loader = new XMLHttpRequest();
        loader.open('GET', "index.txt?"+RandomQuery(), true);
        loader.onreadystatechange = LoadIndex;
        loader.send(null);
        function LoadIndex() {
            if (loader.readyState == 4)
                if (loader.status == 200) {
                    let toc_index = loader.responseText.split("\n");
                    let toc = document.getElementById('toc');
                    var s = "";
                    toc_index.forEach(element => {
                        s += ReadIndex(element);
                    });
                    toc.innerHTML = s;

                }
        }
        function ReadIndex(element) {
            let es = element.split(',');
            let r = "";
            if (es.length > 1) {
                r = "<div onclick=\"LoadBlog('" + index.length + "')\">" + es[1] + "</div>"
            }
            else {
                es.push(es[0]);
                r = "<div onclick=\"LoadBlog('" + index.length + "')\">" + es[0] + "</div>"
            }
            index.push(es);
            return r;
            //后面是Tag，以后再说

        }
    </script>
</body>

</html>